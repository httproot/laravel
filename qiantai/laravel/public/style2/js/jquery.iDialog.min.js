/**
 * jQuery拖拽 & 弹出层
 * API: http://dreamback.github.io/idialog/
 * Author: heshimeng1987@qq.com
 */
~function(a,b,c){var d,e=a(b),f=a(document),g=a.browser.msie,h=parseInt(a.browser.version),i=g&&7>h,j=1e4;!function(){var a,b,c=document.getElementsByTagName("script"),d=0,e=c.length,f=document.createElement("link");for(f.setAttribute("rel","stylesheet");e>d;d++)if(a=c["dialog-theme"]||c[d].getAttribute("dialog-theme")){b=c[d].src||c[d].getAttribute("src"),b=b.substring(0,b.lastIndexOf("/"))+"/theme/",f.setAttribute("href",b+a+"/style.css"),c[d].parentNode.insertBefore(f,c[d]);break}}(),drag=function(a,b){return new drag.fn.init(a,b)},drag.fn=drag.prototype={init:function(b){var c=this,d="(document.documentElement || document.body)";this.target=a(b.target),b=b||{},this.root=b.root?a(b.root):this.target,this.min=b.min,this.max=b.max,this.start=b.start,this.move=b.move,this.end=b.end,this.fixed=b.fixed,this.startPosition={},this.movePosition={};var g=function(a){return a=c.fixEvent(a),c.startPosition={x:a.layerX,y:a.layerY},c.start&&c.start(c.startPosition),f.bind("mousemove",h).bind("mouseup",j),this.setCapture&&this.setCapture(!1),a.preventDefault(),!1},h=function(a){return a=c.fixEvent(a),c.movePosition={x:a.clientX-c.startPosition.x,y:a.clientY-c.startPosition.y},c.limit(),c.fixed&&i?(c.root[0].style.setExpression("left","eval("+d+".scrollLeft + "+(c.movePosition.x-e.scrollLeft())+') + "px"'),c.root[0].style.setExpression("top","eval("+d+".scrollTop + "+(c.movePosition.y-e.scrollTop())+') + "px"')):c.root.css({left:c.movePosition.x,top:c.movePosition.y}),c.move&&c.move(c.movePosition),!1},j=function(){return f.unbind("mousemove",h).unbind("mouseup",j),c.end&&c.end(c.movePosition),!1};this.target.bind("mousedown",g).bind("mouseup",function(){this.releaseCapture&&this.releaseCapture()})},fixEvent:function(a){return a.pageX||(a.pageX=a.clientX+e.scrollTop(),a.pageY=a.clientY+e.scrollLeft()),a.layerX||(a.layerX=a.clientX-parseInt(this.root.css("left")),a.layerY=a.clientY-parseInt(this.root.css("top"))),a},limit:function(){this.min!==c&&(this.movePosition={x:Math.max(this.min.x,this.movePosition.x),y:Math.max(this.min.y,this.movePosition.y)}),this.max!==c&&(this.movePosition={x:Math.min(this.max.x,this.movePosition.x),y:Math.min(this.max.y,this.movePosition.y)})}},drag.fn.init.prototype=drag.fn,b.iDrag=a.drag=drag,d=function(a){return a.id&&d.get[a.id]!==c?(d.get[a.id].show(),d.get[a.id]):new d.fn.init(a)},d.fn=d.prototype={init:function(b){this.id=b.id,this._lock=b.lock||!1,this.fixed=b.fixed||!1,this.width=b.width||"auto",this.height=b.height||"auto",this.top=b.top,this.left=b.left,this.padding=b.padding||20,this._content=b.content||"loading...",this._init=b.init,this._show=b.show||function(){},this._hide=b.hide||function(){},this.opacity=b.opacity===c?.3:b.opacity,this.background=b.background||"#000",this.title=b.title===c?"消息":b.title,this.follow=b.follow===c?!1:a(b.follow),this.drag=b.drag===c?!0:b.drag,this.effect=b.effect===c?"i-scale":b.effect,this.esc=b.esc===c?!0:b.esc,this.time=b.time,this.inited=!1,this.myDrag={},this._btn=b.btn,this.$body=a(document.body),this.show(),this.events(),this._init&&this._init.call(this)},lock:function(){var b=document.createElement("div");this.$lock=a(b).addClass("i-dialog-lock").css({zIndex:++j,height:f.height(),background:this.background}).html(i?'<iframe src="about:blank"></iframe>':""),this.$body[0].appendChild(b)},createHTML:function(){this._lock&&this.lock(),this.inited=!0;var b=document.createElement("div"),c="",d=this;this.title!==!1&&(c='<div class="target"><h2 class="title">'+this.title+'</h2><a href="javascript:void(0);" title="关闭" class="close">×</a></div>'),c+='<div class="content"></div>',this._btn&&(c+='<div class="wrapBtn"></div>'),this.$body[0].appendChild(b),this.$dialog=a(b).addClass("i-dialog").html(c).css({zIndex:++j,width:this.width,height:this.height}),this.$dialog.find("*").each(function(){d["$"+this.className]=a(this),this.className="i-"+this.className}),this.$content.css({padding:this.padding}),this.effect&&this.$dialog.addClass(this.effect),this._btn&&this.btn(this._btn,1),this.drag?this.myDrag=a.drag({target:this.$target,root:this.$dialog,fixed:this.fixed}):this.$target.css("cursor","default"),this.setPosition(),this.content(),this.title===!1&&this.$dialog.css({background:"none",boxShadow:"none",borderRadius:0,border:"none"})},content:function(a){return this.content=a||this.content,"string"==typeof this._content?this.$content.html(this._content):"object"==typeof this._content&&1===this._content.nodeType&&(this.$content[0].appendChild(this._content),this._content.style.display="block"),this},setPosition:function(){this.fixed?i?(this.$dialog.css({position:"absolute"}),a("html").css({backgroundImage:"url(about:blank)",backgroundAttachment:"fixed"})):this.$dialog.css({position:"fixed"}):this.$dialog.css({position:"absolute"})},show:function(){if(!this.inited&&this.createHTML(),this.id&&!d.get[this.id]&&(d.get[this.id]=this),this._show.call(this)!==!1){this._lock&&(this.$lock.show(),g&&9>h&&this.$lock.css({opacity:this.opacity})),this.width=this.$dialog.width(),this.height=this.$dialog.height();var a=e.width(),b=e.height(),f=e.scrollLeft(),j=e.scrollTop(),k=this;this.follow&&this._follow(),this.$dialog.show().css({top:this.top!==c?this.top:.382*(b-this.height)+(i||!this.fixed?j:0),left:this.top!==c?this.left:(a-this.width)/2+(i||!this.fixed?f:0),width:this.width,height:this.height}),this.width=this.$dialog.outerWidth(),this.height=this.$dialog.outerHeight(),setTimeout(function(){k._lock&&k.$lock.css({opacity:k.opacity}),k.effect&&k.$dialog.addClass("i-show")},this.effect?50:0),this.time=this.time?setTimeout(function(){k.hide()},this.time):0}},_follow:function(){var a=this.follow.offset(),b=parseInt(this.follow.outerWidth()),c=parseInt(this.follow.outerHeight()),d=e.scrollTop(),f=e.scrollLeft(),g=e.width(),h=e.height(),i=d+h-this.height,j=f+g-this.width;this.top=a.top+c,this.left=a.left-(this.width-b)/2,this.top=this.top>i?a.top-this.height:this.top,this.left=this.left>j?j:this.left},hide:function(){if(this._hide.call(this)!==!1){var a=this.$dialog[0].style,b=0,d=this;(a.transform!==c||a.webkitTransform!==c||a.mozTransform!==c||a.msTransform!==c)&&(b=300),this.$dialog.removeClass("i-show"),this._lock&&this.$lock.css({opacity:0}),this.time&&clearTimeout(this.time),setTimeout(function(){d._lock&&d.$lock.hide(),d.$dialog.hide()},this.effect?b:0)}},events:function(){var b=this,c=null;e.bind("resize",function(){c&&clearTimeout(c),c=setTimeout(function(){b.limit(),parseInt(b.$dialog.css("left"))>b.myDrag.max.x&&b.$dialog.css("left",b.myDrag.max.x),parseInt(b.$dialog.css("top"))>b.myDrag.max.y&&b.$dialog.css("top",b.myDrag.max.y)},100)}),this.$close&&this.$close.bind("click",function(){b.hide()}),this.$lock&&this.$lock.bind("dblclick",function(){b.hide()}),this.esc&&f.bind("keyup",function(a){27==a.keyCode&&"none"!=b.$dialog.css("display")&&b.hide()}),this.$dialog.bind("mousedown",function(){a.each(d.get,function(){this.$dialog.zIndex==j&&this.$dialog.css({zIndex:j-1})}),a(this).css({zIndex:j})}),this.drag&&(this.myDrag.start=function(){b.limit()})},limit:function(){var a=e.width(),b=e.height(),c=e.scrollLeft(),d=e.scrollTop();this.myDrag.min={x:0,y:0},this.fixed&&i&&(this.myDrag.min={x:c,y:d}),this.myDrag.max=this.fixed?i?{x:a+c-this.width,y:b+d-this.height}:{x:a-this.width,y:b-this.height}:{x:a-this.width,y:f.height()-this.height}},btn:function(b,c){var d,e=this;a.each(b,function(a){d=!c&&e._btn[a]?e._btn[a].input:document.createElement("input"),d.type="button",d.value=this.val||d.value,d.className=this.type||d.className||"",this.disabled===!0?(d.disabled="disabled",d.className+=" i-disabled"):this.disabled===!1&&(d.disabled="",d.className=d.className.replace(" i-disabled","")),(c||!e._btn[a])&&e.$wrapBtn.append(d),e._btn[a]||(e._btn[a]=this),e._btn[a].input=d,d.onclick=this.click?function(a){return function(){(a.click&&!1!==a.click.call(e,this)||!a.click)&&e.hide()}}(this):d.onclick||function(){e.hide()}})}},d.fn.init.prototype=d.fn,b.iDialog=a.dialog=d,d.get={},b.iDialog.get=a.dialog.get=d.get}(jQuery,this);